version: '3.8'
services:
  worker:
    image: docker-registry.sabay.com/docker/db-haproxy:latest
    environment:
      DB_PORT: '6701'
      IP_WHITELIST: 108.67.102.107
      DB_DOMAIN_AND_PORT: 405opl4gm7oa7xm5.mongodb.sabay.com:27017
    networks:
      - mysabay-39674920
    configs:
      - source: cloud_db_proxy_template
        target: /usr/local/etc/haproxy/haproxy.template.cfg
        mode: 644
    ports:
      - target: 6701
        published: 6701
        protocol: tcp
        mode: host
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.role == worker
      restart_policy:
        condition: any
        delay: 10s
        max_attempts: 5
        window: 120s
      resources:
        limits:
          cpus: '12'
          memory: 65536M
    command: haproxy.sh
    hostname: 405opl4gm7oa7xm4.kosalkan.com
networks:
  mysabay-39674920:
    external: true
configs:
  cloud_db_proxy_template:
    external: true
